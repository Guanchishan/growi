{"version":3,"file":"use-codemirror-editor.js","sources":["../../../../src/services/codemirror-editor/use-codemirror-editor/use-codemirror-editor.ts"],"sourcesContent":["import { useMemo } from 'react';\n\nimport { indentWithTab, defaultKeymap } from '@codemirror/commands';\nimport { markdown, markdownLanguage } from '@codemirror/lang-markdown';\nimport { languages } from '@codemirror/language-data';\nimport { EditorState, Prec, type Extension } from '@codemirror/state';\nimport { keymap, EditorView } from '@codemirror/view';\nimport { useCodeMirror, type UseCodeMirror } from '@uiw/react-codemirror';\nimport deepmerge from 'ts-deepmerge';\n\nimport { useAppendExtensions, type AppendExtensions } from './utils/append-extensions';\nimport { useFocus, type Focus } from './utils/focus';\nimport { useGetDoc, type GetDoc } from './utils/get-doc';\nimport { useInitDoc, type InitDoc } from './utils/init-doc';\nimport { useSetCaretLine, type SetCaretLine } from './utils/set-caret-line';\n\ntype UseCodeMirrorEditorUtils = {\n  initDoc: InitDoc,\n  appendExtensions: AppendExtensions,\n  getDoc: GetDoc,\n  focus: Focus,\n  setCaretLine: SetCaretLine,\n}\nexport type UseCodeMirrorEditor = {\n  state: EditorState | undefined;\n  view: EditorView | undefined;\n} & UseCodeMirrorEditorUtils;\n\n\nconst defaultExtensions: Extension[] = [\n  markdown({ base: markdownLanguage, codeLanguages: languages }),\n  keymap.of([indentWithTab]),\n  Prec.lowest(keymap.of(defaultKeymap)),\n];\n\nexport const useCodeMirrorEditor = (props?: UseCodeMirror): UseCodeMirrorEditor => {\n\n  const mergedProps = useMemo<UseCodeMirror>(() => {\n    return deepmerge(\n      props ?? {},\n      {\n        extensions: defaultExtensions,\n        // Reset settings of react-codemirror.\n        // The extension defined first will be used, so it must be disabled here.\n        indentWithTab: false,\n        basicSetup: {\n          defaultKeymap: false,\n        },\n      },\n    );\n  }, [props]);\n\n  const { state, view } = useCodeMirror(mergedProps);\n\n  const initDoc = useInitDoc(view);\n  const appendExtensions = useAppendExtensions(view);\n  const getDoc = useGetDoc(view);\n  const focus = useFocus(view);\n  const setCaretLine = useSetCaretLine(view);\n\n  return {\n    state,\n    view,\n    initDoc,\n    appendExtensions,\n    getDoc,\n    focus,\n    setCaretLine,\n  };\n};\n"],"names":["defaultExtensions","markdown","markdownLanguage","languages","keymap","indentWithTab","Prec","defaultKeymap","useCodeMirrorEditor","props","mergedProps","useMemo","deepmerge","state","view","useCodeMirror","initDoc","useInitDoc","appendExtensions","useAppendExtensions","getDoc","useGetDoc","focus","useFocus","setCaretLine","useSetCaretLine"],"mappings":";;;;;;;;;;;;;AA6BA,MAAMA,IAAiC;AAAA,EACrCC,EAAS,EAAE,MAAMC,GAAkB,eAAeC,GAAW;AAAA,EAC7DC,EAAO,GAAG,CAACC,CAAa,CAAC;AAAA,EACzBC,EAAK,OAAOF,EAAO,GAAGG,CAAa,CAAC;AACtC,GAEaC,IAAsB,CAACC,MAA+C;AAE3E,QAAAC,IAAcC,EAAuB,MAClCC;AAAA,IACLH,KAAS,CAAC;AAAA,IACV;AAAA,MACE,YAAYT;AAAA;AAAA;AAAA,MAGZ,eAAe;AAAA,MACf,YAAY;AAAA,QACV,eAAe;AAAA,MACjB;AAAA,IACF;AAAA,EAAA,GAED,CAACS,CAAK,CAAC,GAEJ,EAAE,OAAAI,GAAO,MAAAC,EAAK,IAAIC,EAAcL,CAAW,GAE3CM,IAAUC,EAAWH,CAAI,GACzBI,IAAmBC,EAAoBL,CAAI,GAC3CM,IAASC,EAAUP,CAAI,GACvBQ,IAAQC,EAAST,CAAI,GACrBU,IAAeC,EAAgBX,CAAI;AAElC,SAAA;AAAA,IACL,OAAAD;AAAA,IACA,MAAAC;AAAA,IACA,SAAAE;AAAA,IACA,kBAAAE;AAAA,IACA,QAAAE;AAAA,IACA,OAAAE;AAAA,IACA,cAAAE;AAAA,EAAA;AAEJ;"}